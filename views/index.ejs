<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moois</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="Moois_website" type="x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="module">
        import loadTunniplaan from '/tunniplaan';
        import loadKodutoo from '/kodutoo';

        if('<%-pohivaade-%>' === 'tunniplaan' & !window.name){
            window.name = 'tunniplaan'
            document.getElementById('tunniplaan').style.display='block';
            document.getElementById('kodutoo').style.display='none';
        }
        else if(window.name === 'tunniplaan'){
            document.getElementById('tunniplaan').style.display='block';
            document.getElementById('kodutoo').style.display='none';
        }
        else{
            window.vaade = 'kodutoo'
            document.getElementById('tunniplaan').style.display='none';
            document.getElementById('kodutoo').style.display='block';
        }

        if(localStorage.getItem("dark_mode") !== null){
            if(localStorage.getItem("dark_mode") === "true"){
                let element = document.body;
                element.classList.add("dark-mode");
            }
        }

        document.addEventListener('DOMContentLoaded', function(){
            const tunniplaan = loadTunniplaan('<%-ois%>')
            const kodutoo = loadKodutoo('<%-moodle%>',<%-evstatus%>)
            console.log(tunniplaan)
            document.getElementsByClassName('fc-kodutood-button')[0].addEventListener("click", function(){
                kodutoo.updateSize();
            })
            
            document.getElementsByClassName('fc-tunniplaan-button')[0].addEventListener("click", function(){
                tunniplaan.updateSize();
            })

            document.addEventListener('visibilitychange', function(info){
                if(document.visibilityState ==='visible'){
                    tunniplaan.refetchEvents();
                    kodutoo.refetchEvents();
                }
            })
            
            document.getElementById('switch').addEventListener('change', function() {
                let element = document.body;
                if (this.checked) {
                    localStorage.setItem("dark_mode", true)
                    element.classList.add("dark-mode");
                } else {
                    localStorage.setItem("dark_mode", false)
                    element.classList.remove("dark-mode");
                }
            });
        })
        
    </script>
</head>
<body>
    <script>
        document.addEventListener("scroll", (event) => {
                let scroll = this.scrollY;
                if (scroll > 2 & document.getElementById('kodutoo').style.display === 'block') {
                    document.getElementById('kodutoo').querySelector(".fc-header-toolbar").classList.add("shadow");
                } else {
                    document.getElementById('kodutoo').querySelector(".fc-header-toolbar").classList.remove("shadow");
                }
            }); 
    </script>
    <div class="loader"></div>
    <div id='tunniplaan' class="tunniplaan"></div>
    <div id='kodutoo' class="kodutoo"></div>
    <div id="my-modal" class="modal">
        <form action="/settingssave" method="POST">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="submit" class="close" onclick="document.getElementById('my-modal').style.display='none'">&times;</button>
                    <h2>Seadmed</h2>
                </div>
                <div class="modal-body">
                    <p>Õis kalendri link:<input name="ois" type="text" id="ois" value="<%=ois%>" class="modal-input" placeholder="Õis"/></p>
                    <p>Moodle kalendri link:<input name="moodle" type="text" value="<%=moodle%>" id="moodle" placeholder="Moodle" class="modal-input"/></p>
                    <p>Põhivaade:<select name="pohivaade" id="pohivaade" class="pv-select">
                        <% if(pohivaade == 'tunniplaan'){%>
                            <option id="pohivaade" value='tunniplaan' selected>Tunniplaan</option>
                            <option id="pohivaade" value='kodutoo'>Kodutoo</option>
                        <%} else {%>
                            <option id="pohivaade" value='tunniplaan'>Tunniplaan</option>
                            <option id="pohivaade" value='kodutoo' selected>Kodutöö</option>
                        <%}%>
                    </select></p>
                    <p>Tume režiim:<input type="checkbox" id="switch" /><label for="switch">Toggle</label></p>
                    <p><button type="button" class="logout-button" onclick="window.location.href='logout'">Logi välja</button></p>
                </div>
            </div>
        </form>
    </div>
</body>
</html>